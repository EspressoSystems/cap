<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API library for the auditable anonymous payment system which allows for issuance, transfers and (un)freezing of arbitrary asset that are fully private, yet publicly verifiable and auditable. It is strongly recommended to refer to at least the first two chapters of Spec for an introduction to core concepts, data structures and main workflows."><meta name="keywords" content="rust, rustlang, rust-lang, jf_cap"><title>jf_cap - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../jf_cap/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate jf_cap</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.0.1</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all jf_cap's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="jf_cap" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">jf_cap</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/jf_cap/lib.rs.html#1-794" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>API library for the <em>auditable anonymous payment</em> system which allows for
issuance, transfers and (un)freezing of arbitrary asset that are fully
private, yet publicly verifiable and auditable. It is strongly recommended
to refer to at least the first two chapters of <a href="https://gitlab.com/translucence/crypto/AT-spec/-/jobs/1368849847/artifacts/file/main.pdf">Spec</a> for an introduction to
core concepts, data structures and main workflows.</p>
<h1 id="entities-and-their-keys" class="section-header"><a href="#entities-and-their-keys">Entities and Their Keys</a></h1>
<p>As explained in Chapter 1.2 of <a href="https://gitlab.com/translucence/crypto/AT-spec/-/jobs/1368849847/artifacts/file/main.pdf">Spec</a>, there are 5 main roles and all their
public/private key related materials can be found under the <a href="keys/index.html" title="keys">keys</a> module.
Common actions involving a key can usually be found as associated methods
of the key struct – e.g. for an auditor/tracer to decrypt memos for
him/her, use <a href="keys/struct.AuditorKeyPair.html#method.open_transfer_audit_memo" title="keys::AuditorKeyPair::open_transfer_audit_memo()"><code>keys::AuditorKeyPair::open_transfer_audit_memo()</code></a>.</p>
<h1 id="3-types-of-transaction-and-their-workflows" class="section-header"><a href="#3-types-of-transaction-and-their-workflows">3 Types of Transaction and Their Workflows</a></h1>
<p>As explained in Chapter 2.1 of <a href="https://gitlab.com/translucence/crypto/AT-spec/-/jobs/1368849847/artifacts/file/main.pdf">Spec</a>, we support 3 types of transaction
(txn) – <strong>transfer</strong>, <strong>mint</strong> and <strong>freeze</strong>.</p>
<p>While an actual transaction may contain extra information such as metadata
(timestamp), consensus related data etc., our APIs center around the core
body of a transaction which we call a <a href="enum.TransactionNote.html" title="TransactionNote"><code>TransactionNote</code></a>. To generate or
verify a transaction note of a certain type, go to respective module under
the same type name – e.g. <a href="transfer/struct.TransferNote.html#method.generate_native" title="transfer::TransferNote::generate_native()"><code>transfer::TransferNote::generate_native()</code></a> or
<a href="freeze/struct.FreezeNote.html#method.verify" title="freeze::FreezeNote::verify()"><code>freeze::FreezeNote::verify()</code></a>.</p>
<h2 id="general-workflow" class="section-header"><a href="#general-workflow">General Workflow</a></h2>
<p>The “privacy-preserving” property of our payment system is largely
the result of how each transaction demonstrates its validity and how
validators/miners verify them.
Namely, in contrast to transaction on Ethereum, which put all necessary info
of a txn (amount, sender, receiver etc.) in the open to maintain public
verifiability, we utilize cryptographic proofs that can mathematically
attest to the “truth of any statement” – statement such as “This txn
preserves the balance of total amount of inputs and outputs, plus all
senders are legitimate owners of their asset records …”.</p>
<p>To generate such a proof, one would need to first settle the exact statement
and deterministically derive one <em>proving key</em> and one <em>verifying key</em> from
the statement, the former for the prover of the statement (i.e. the txn
creator) whereas the latter for the verifier of the statement (i.e. the
validators) – this is called <em>preprocessing</em>, and for the validity
statement for each txn type, their APIs can be found under <a href="proof/index.html" title="proof">proof</a> module.</p>
<p>One more complication steming from the proof system we use is: before
preprocess any concrete statement, we need to retrieve a so-called
<em>universal parameter</em> which will be needed during subsequent preprocessings.
Reason why it’s called “universal” is because this parameter is independent
of the concrete statement of a bounded size.</p>
<p>Therefore, the generic workflow or life cycle of a txn note is as follows:</p>
<ol>
<li>(during system setup) validators and users fetch the universal
parameter<sup id="fnref1"><a href="#fn1">1</a></sup>.</li>
<li>sender of a txn runs the preprocessing function to get the proving key of
the correct txn type, providing the universal parameter.</li>
<li>sender decides fee, then assembles all other necessary secret witnesses
necessary to generate the txn note, a list of <em>receiver memos</em> (one for each
output) <sup id="fnref2"><a href="#fn2">2</a></sup> and a signature signed over the memos.</li>
<li>upon receiving txn note, validators verify it.</li>
<li>for public bulletin board maintainers, verify the signature against the
list of memos and the note, and only publish the list of memos if
verification passed.</li>
<li>receivers scan the bulletin board to try to decrypt newly added memos to
find record openings designated to him which enables him to spend them
further.</li>
</ol>
<h2 id="proving-keys--verifying-keys" class="section-header"><a href="#proving-keys--verifying-keys">Proving Keys &amp; Verifying Keys</a></h2>
<p>Ideally, users and validators should have a copy of the proving and
verifying keys locally as binary files, and load to memory on demand –
utility functions to help with this can be found under <a href="parameters/index.html" title="parameters">parameters</a> module.</p>
<p>However, currently, deserializing these parameter files takes longer than
reproducing them, thus we recommend only loading the universal parameter via
<a href="parameters/fn.load_universal_parameter.html" title="parameters::load_universal_parameter()"><code>parameters::load_universal_parameter()</code></a> and then <strong>generate proving keys
and verifying keys on demand</strong>. For example, for transfer txn, invoke
<a href="proof/transfer/fn.preprocess.html" title="proof::transfer::preprocess()"><code>proof::transfer::preprocess()</code></a> inputting the universal parameter you just
loaded to memory <sup id="fnref3"><a href="#fn3">3</a></sup>.</p>
<p>Additional note: there’s potentially different proving/verifying keys for
the same txn type but with different number of inputs, outputs and depth of
the Merkle Tree accumulating record commitments. Thus, you have to be
careful to use the correct ones, or else you will get an Error.</p>
<h2 id="transaction-note-generation-fee-and-fee-change" class="section-header"><a href="#transaction-note-generation-fee-and-fee-change">Transaction Note Generation: Fee and Fee Change</a></h2>
<p>Each transaction could decide to include a non-negative fee in <em>native asset
type</em>.
This is achieved by providing a <a href="structs/struct.FeeInput.html" title="structs::FeeInput"><code>structs::FeeInput</code></a> and specify the
actual amount of <code>fee: u64</code> to pay whenever you generate a note.
Be careful: the value of <code>FeeInput</code> has to be no smaller than <code>fee</code>, and the
difference is <em>fee change</em> which would be included in the output with the
same owner as the fee payer.</p>
<h2 id="transaction-note-generation-assembling-all-necessary-witnesses" class="section-header"><a href="#transaction-note-generation-assembling-all-necessary-witnesses">Transaction Note Generation: Assembling All Necessary Witnesses</a></h2>
<p>There are a dozen of secret witness data required to feed into the txn note
generation as inputs, all necessary data structures can be found under
<a href="structs/index.html" title="structs">structs</a> module, and the best place to learn about how to assemble those
input parameters is through our integration test examples.</p>
<p>Let us strongly recommend again: <strong>please read example workflows in
<a href="https://gitlab.com/translucence/crypto/jellyfish/-/tree/main/transactions/tests">integration test</a>!</strong></p>
<h2 id="transaction-note-verification-batch-verification" class="section-header"><a href="#transaction-note-verification-batch-verification">Transaction Note Verification: Batch Verification</a></h2>
<p>In addition to verification on a single txn note, we also offers batch
verification which has lower amortized cost – this is offered at
<a href="fn.txn_batch_verify.html" title="txn_batch_verify()"><code>txn_batch_verify()</code></a>.</p>
<h1 id="transaction-fee-collection-for-validators" class="section-header"><a href="#transaction-fee-collection-for-validators">Transaction Fee Collection for Validators</a></h1>
<p>At the ledger level, when a validator proposes a block containing a list of
transactions, the validator is entitled to claim all the txn fee specified
within the block. We have deviced two APIs regarding txn fee collection:</p>
<ul>
<li>for block proposer: <a href="fn.prepare_txns_fee_record.html" title="prepare_txns_fee_record()"><code>prepare_txns_fee_record()</code></a></li>
<li>for the rest of validators who upon validating the block, try to credit
the txn fee record to rightful block proposer:
<a href="fn.derive_txns_fee_record.html" title="derive_txns_fee_record()"><code>derive_txns_fee_record()</code></a></li>
</ul>
<p>Again, we recommend readers take a look at the <a href="https://gitlab.com/translucence/crypto/jellyfish/-/tree/main/transactions/tests">integration test</a> to get an
idea of this workflow in actual mock code.</p>
<div class="footnotes"><hr><ol><li id="fn1"><p>in production, this would be a file downloaded from authority
source, but in test and for demo, we can generate them via
<a href="proof/fn.universal_setup.html" title="proof::universal_setup()">proof::universal_setup()</a>&nbsp;<a href="#fnref1">↩</a></p></li><li id="fn2"><p>Publishing the list of receiver memos to a public
bulletin board is optional, as long as the receivers have an authenticated
way of receiving the record openings of the output record.&nbsp;<a href="#fnref2">↩</a></p></li><li id="fn3"><p>But do expect the slow deserialization problem to be resolved
in the future by which time those preprocessings are one-time procedule, and
normally you only need to load those proving/verifying keys from files using
APIs in <a href="parameters/index.html" title="parameters">parameters</a>.&nbsp;<a href="#fnref3">↩</a></p></li></ol></div></div></details><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="mod" href="bench_utils/index.html" title="jf_cap::bench_utils mod">bench_utils</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="mod" href="constants/index.html" title="jf_cap::constants mod">constants</a></div><div class="item-right docblock-short"><p>Constants used across the whole library</p>
</div><div class="item-left module-item"><a class="mod" href="errors/index.html" title="jf_cap::errors mod">errors</a></div><div class="item-right docblock-short"><p>Error types related to transaction API</p>
</div><div class="item-left module-item"><a class="mod" href="freeze/index.html" title="jf_cap::freeze mod">freeze</a></div><div class="item-right docblock-short"><p>Generation and verification of freezing transfer notes</p>
</div><div class="item-left module-item"><a class="mod" href="keys/index.html" title="jf_cap::keys mod">keys</a></div><div class="item-right docblock-short"><p>Cryptographic key related data structures</p>
</div><div class="item-left module-item"><a class="mod" href="mint/index.html" title="jf_cap::mint mod">mint</a></div><div class="item-right docblock-short"><p>Generation and verification of mint notes (a.k.a Asset Issuance)</p>
</div><div class="item-left module-item"><a class="mod" href="parameters/index.html" title="jf_cap::parameters mod">parameters</a></div><div class="item-right docblock-short"><p>Helper functions to create, save to and fetch from files for prover/verifier
parameters.</p>
</div><div class="item-left module-item"><a class="mod" href="proof/index.html" title="jf_cap::proof mod">proof</a></div><div class="item-right docblock-short"><p>SNARK proofs data structures, generation and verification API</p>
</div><div class="item-left module-item"><a class="mod" href="structs/index.html" title="jf_cap::structs mod">structs</a></div><div class="item-right docblock-short"><p>record-related data structures in transactions</p>
</div><div class="item-left module-item"><a class="mod" href="transfer/index.html" title="jf_cap::transfer mod">transfer</a></div><div class="item-right docblock-short"><p>Generation and verification of auditable anonymous transfer notes</p>
</div><div class="item-left module-item"><a class="mod" href="utils/index.html" title="jf_cap::utils mod">utils</a></div><div class="item-right docblock-short"><p>Utility structures and functions needed for internal purposes, writing tests
or benchmarks.</p>
</div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="enum" href="enum.TransactionNote.html" title="jf_cap::TransactionNote enum">TransactionNote</a></div><div class="item-right docblock-short"><p>A transaction note contains a note of possibly various transaction types,
including transfer, mint and freeze.</p>
</div><div class="item-left module-item"><a class="enum" href="enum.TransactionVerifyingKey.html" title="jf_cap::TransactionVerifyingKey enum">TransactionVerifyingKey</a></div><div class="item-right docblock-short"><p>A transaction verifying key contains a proof verification key of possibly
various transaction types, including transfer, mint and freeze.</p>
</div></div><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="fn" href="fn.derive_txns_fee_record.html" title="jf_cap::derive_txns_fee_record fn">derive_txns_fee_record</a></div><div class="item-right docblock-short"><p>Derive the record commitment corresponding to collected fee from a list of
transaction notes (within a block). The result is a record commitment to be
inserted in the ledger. This function is intended to be called by nodes
validating blocks.</p>
</div><div class="item-left module-item"><a class="fn" href="fn.prepare_txns_fee_record.html" title="jf_cap::prepare_txns_fee_record fn">prepare_txns_fee_record</a></div><div class="item-right docblock-short"><p>Prepare the record opening corresponding to collected fee from a list of
transaction notes (within a block). The result is a record opening whose
blinding factor should be directly appended to the same block before being
disseminated to other nodes. This function is intended to be called by nodes
proposing blocks.</p>
</div><div class="item-left module-item"><a class="fn" href="fn.sign_receiver_memos.html" title="jf_cap::sign_receiver_memos fn">sign_receiver_memos</a></div><div class="item-right docblock-short"><p>Compute signature over a list of receiver memos</p>
</div><div class="item-left module-item"><a class="fn" href="fn.txn_batch_verify.html" title="jf_cap::txn_batch_verify fn">txn_batch_verify</a></div><div class="item-right docblock-short"><p>Batch verification for transaction</p>
</div></div><h2 id="types" class="section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="type" href="type.AccMemberWitness.html" title="jf_cap::AccMemberWitness type">AccMemberWitness</a></div><div class="item-right docblock-short"><p>The proof of membership in an accumulator (Merkle tree) for an asset record</p>
</div><div class="item-left module-item"><a class="type" href="type.BaseField.html" title="jf_cap::BaseField type">BaseField</a></div><div class="item-right docblock-short"><p>type alias for scalar field of the bls curve</p>
</div><div class="item-left module-item"><a class="type" href="type.CurveParam.html" title="jf_cap::CurveParam type">CurveParam</a></div><div class="item-right docblock-short"><p>type alias for jubjub curve parameter</p>
</div><div class="item-left module-item"><a class="type" href="type.KeyPair.html" title="jf_cap::KeyPair type">KeyPair</a></div><div class="item-right docblock-short"><p>The key pair of Schnorr signature scheme</p>
</div><div class="item-left module-item"><a class="type" href="type.MerkleCommitment.html" title="jf_cap::MerkleCommitment type">MerkleCommitment</a></div><div class="item-right docblock-short"><p>Elements needed for a full commitment to MerkleTree</p>
</div><div class="item-left module-item"><a class="type" href="type.MerkleFrontier.html" title="jf_cap::MerkleFrontier type">MerkleFrontier</a></div><div class="item-right docblock-short"><p>proof sufficient, with commitment, to define sparse MerkleTree</p>
</div><div class="item-left module-item"><a class="type" href="type.MerkleLeaf.html" title="jf_cap::MerkleLeaf type">MerkleLeaf</a></div><div class="item-right docblock-short"><p>MerkleTree leaf element</p>
</div><div class="item-left module-item"><a class="type" href="type.MerkleLeafProof.html" title="jf_cap::MerkleLeafProof type">MerkleLeafProof</a></div><div class="item-right docblock-short"><p>MerkleTree leaf element with associated authenticated path</p>
</div><div class="item-left module-item"><a class="type" href="type.MerklePath.html" title="jf_cap::MerklePath type">MerklePath</a></div><div class="item-right docblock-short"><p>An authentication path of a ternary Merkle tree.</p>
</div><div class="item-left module-item"><a class="type" href="type.MerkleTree.html" title="jf_cap::MerkleTree type">MerkleTree</a></div><div class="item-right docblock-short"><p>Merkle Tree.</p>
</div><div class="item-left module-item"><a class="type" href="type.NodeValue.html" title="jf_cap::NodeValue type">NodeValue</a></div><div class="item-right docblock-short"><p>Represents the value for a node in the merkle tree</p>
</div><div class="item-left module-item"><a class="type" href="type.PairingEngine.html" title="jf_cap::PairingEngine type">PairingEngine</a></div><div class="item-right docblock-short"><p>type alias for pairing parameter</p>
</div><div class="item-left module-item"><a class="type" href="type.ScalarField.html" title="jf_cap::ScalarField type">ScalarField</a></div><div class="item-right docblock-short"><p>type alias for scalar field of the jubjub curve</p>
</div><div class="item-left module-item"><a class="type" href="type.Signature.html" title="jf_cap::Signature type">Signature</a></div><div class="item-right docblock-short"><p>The signature of Schnorr signature scheme</p>
</div><div class="item-left module-item"><a class="type" href="type.VerKey.html" title="jf_cap::VerKey type">VerKey</a></div><div class="item-right docblock-short"><p>The verification key of Schnorr signature scheme</p>
</div><div class="item-left module-item"><a class="type" href="type.VerifyingKey.html" title="jf_cap::VerifyingKey type">VerifyingKey</a></div><div class="item-right docblock-short"><p>plonk</p>
</div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="jf_cap" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>